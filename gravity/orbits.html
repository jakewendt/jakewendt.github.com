<!DOCTYPE html>
<html>
<head>
<title>Orbits</title>
<style>
</style>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js" type="text/javascript"></script>
<script type="text/javascript">
//<![CDATA[
var G = 6.67384e-11;	//	N m^2 / kg^2
var time = 0;  // seconds
var delta_t = 72*3600;	// seconds
var scale = 6e9;	//	meters to pixels	(2e9) just includes Saturn's orbit on 1500px canvas 6e9 just includes Neptune
var bodies = [];
var canvas_size = 1500;

function SolarSystem(_options){
	var options = {}
	$.extend( true, options, _options );
	this.fg = this.foreground = document.getElementById(options.foreground_canvas).getContext("2d");
	this.bg = this.background = document.getElementById(options.background_canvas).getContext("2d");
	this.bodies = [];
	this.plot = function(){
		this.fg.clearRect(0,0,this.fg.canvas.width,this.fg.canvas.height);
		// $.each(this.bodies, function(){ this.plot( this.bg ) });
		// $.each(this.bodies, function(){ this.plot( this.fg ) });
	};
	this.step = function(){
	};
	this.add_body = function(new_body){
	};
};

function Body(_options){
	var options = {
		name:     'UnNamed',
		mass:     1.9891e30, //	kg
		radius: 1,	// m
		position: [0,0],	// m
		velocity: [0,0]		// m/s
	}
	$.extend( true, options, _options );
	this.name = options.name;
	this.mass = options.mass;
	this.radius = options.radius;	// depending on scale, radius will usually be rounded up to 1 anyway
	this.position = options.position;
	this.x = this.position[0];
	this.y = this.position[1];
	this.velocity = options.velocity;
	this.vx = this.velocity[0];
	this.vy = this.velocity[1];
	this.fx = null;
	this.fy = null;
	this.ctx = options.ctx;
	this.unplot = function(){
		if( typeof this.ctx == 'object' ){
			this.ctx.save();
			this.ctx.fillStyle = 'rgba(255,255,255,1)';
			this.ctx.beginPath();
			//	draw a bigger(3+ versus 2+) white circle over previous circle
			//	arc( x-center, y-center, radius, start_angle, end_angle, counter_clockwise_flag(optional) )
			this.ctx.arc( (canvas_size/2)+(this.x/scale),(canvas_size/2)+(-this.y/scale),
				3+(this.radius/scale),0,2*Math.PI);	// - added to invert y-axis
			this.ctx.fill();

			this.ctx.fillStyle = 'rgba(100,100,100,0.2)';
			this.ctx.beginPath();
			//	draw a smaller(1+ versus 2+) gray circle to make a trail
			this.ctx.arc( (canvas_size/2)+(this.x/scale),(canvas_size/2)+(-this.y/scale),
				1+(this.radius/scale),0,2*Math.PI);	// - added to invert y-axis
			this.ctx.fill();
			this.ctx.restore();
		}
	};
	this.plot = function(){
		if( typeof this.ctx == 'object' ){
			this.ctx.beginPath();
			//	arc( x-center, y-center, radius, start_angle, end_angle, counter_clockwise_flag(optional) )
			this.ctx.arc( (canvas_size/2)+(this.x/scale),(canvas_size/2)+(-this.y/scale),
				2+(this.radius/scale),0,2*Math.PI);	// - added to invert y-axis
			this.ctx.fill();
		}
	};
	this.reposition = function(){
		this.unplot();
		this.x = this.x+(this.vx*delta_t);
		this.y = this.y+(this.vy*delta_t);
		this.plot();
		$("tr#"+this.name+" td.x").text( this.x.toExponential(3)  );
		$("tr#"+this.name+" td.y").text( this.y.toExponential(3)  );
	};
	this.revelocity = function(bodies){
		me = this;
		fx = 0;
		fy = 0;
		$.each(bodies,function(){ 
			if( this.name != me.name ){
				dy = me.y-this.y; //	opposite
				dx = me.x-this.x;	//	adjacent
				dsquared = Math.pow( dx, 2 ) + Math.pow( dy, 2 );
				f = -( G * me.mass * this.mass ) / dsquared;
				theta = Math.atan2( dy, dx );	// NOT atan
				fx = fx + ( f * Math.cos( theta ) );
				fy = fy + ( f * Math.sin( theta ) );
			}
		});
		this.fx = fx;
		this.fy = fy;

		$("tr#"+this.name+" td.fx").text( this.fx.toExponential(3)  );
		$("tr#"+this.name+" td.fy").text( this.fy.toExponential(3)  );

		this.vx = this.vx + ( delta_t * fx / this.mass );
		this.vy = this.vy + ( delta_t * fy / this.mass );
		$("tr#"+this.name+" td.vx").text( this.vx.toExponential(3)  );
		$("tr#"+this.name+" td.vy").text( this.vy.toExponential(3)  );
	};	//	this.revelocity = function(bodies){
	this.plot();
};
$(function(){

/*

	Notes for future futsing about...

	Use multiple canvases?  Keeping "trails" on back canvas, use clearRect rather than 
	this drawing a bigger dot over the planet to "erase" it.  
<div style="position: relative;">
 <canvas id="layer1" width="100" height="100" 
   style="position: absolute; left: 0; top: 0; z-index: 0;"></canvas>
 <canvas id="layer2" width="100" height="100" 
   style="position: absolute; left: 0; top: 0; z-index: 1;"></canvas>
</div>

	Add more bodies.  Planets, moons, comets, asteroids, trojan asteroids, etc.
		http://en.wikipedia.org/wiki/3753_Cruithne

	Add a planet at the asteroid belt

	Rather than have a "STOP" button, perhaps a "Pause/Continue" button.

	Real orbit data rather than starting with the averages.

	Some type of "satellite" launch from Earth to Saturn sim.

	Adjustable speed, step_size, 

	Color?

	Make Sun fixed?  No velocity.  No change in position.

	Put javascript in library file so can have multiple simulator html pages.

	Polar coordinates?

*/

	var canvas = document.getElementById("myCanvas");
	canvas.width = canvas_size;
	canvas.height = canvas_size;
	var ctx = canvas.getContext("2d");

	bodies.push( new Body({ 
		ctx: ctx, 
		name: 'Sun', 
		radius: 6.96342e8,
		velocity: [0,-10]  // m/s  need a properly balanced initial condition or the orbit will wander off
	}) );

	bodies.push( new Body({
		ctx: ctx,
		name: 'Mercury',
		mass: 3.3022e23,
		radius: 2.4397e6,	//	m
		position: [5.7909050e10,0],	// m
		velocity: [0,47.362e3]	// m/s
	}) );
	bodies.push( new Body({
		ctx: ctx,
		name: 'Venus',
		mass: 4.8676e24,
		radius: 6.0518e6,	//	m
		position: [1.08208e11,0],	// m
		velocity: [0,35.02e3]
	}) );
	bodies.push( new Body({
		ctx: ctx,
		name: 'Earth',
		mass: 5.97219e24,
		radius: 6.371e6,	// m
		position: [1.49598261e11,0],	// m
		velocity: [0,29.78e3]	// m/s
	}) );
/*
	bodies.push( new Body({
		ctx: ctx,
		name: 'Luna',
		mass: 7.3477e22,	// kg
		radius: 1.7371e6,	//	m
		position: [ 1.49598261e11 + 3.84399e8, 0 ],	// m
		velocity: [0, 29.78e3 + 1022]	// m/s
	})  );
*/
	bodies.push( new Body({
		ctx: ctx,
		name: 'Mars',
		mass: 6.4185e23,	// kg
		radius: 3.3895e6,	// m
		position: [2.299391e11,0],	// m
		velocity: [0,24.077e3]	// m/s
	}) );
	bodies.push( new Body({
		ctx: ctx,
		name: 'Jupiter',
		mass: 1.8986e27,	// kg
		radius: 6.9911e7,	// m
		position: [7.785472e11,0],	// m
		velocity: [0,13.07e3]	// m/s
	}) );
	bodies.push( new Body({
		ctx: ctx,
		name: 'Saturn',
		mass: 5.6846e26,	// kg
		radius: 5.8232e7,	// m
		position: [1.43344937e12,0],	// m
		velocity: [0,9.69e3]	// m/s
	}) );
	bodies.push( new Body({
		ctx: ctx,
		name: 'Uranus',
		mass: 8.6810e25,	// kg
		radius: 25362e3,	// m
		position: [2.876679082e12,0],	// m
		velocity: [0,6.81e3]	// m/s
	}) );
	bodies.push( new Body({
		ctx: ctx,
		name: 'Neptune',
		mass: 1.0243e26,	// kg
		radius: 24622e3,	// m
		position: [4.503443661e12,0],	// m
		velocity: [0,5.43e3]	// m/s
	}) );

//	bodies.push( new Body({
//		ctx: ctx,
//		name: 'Earth',
//		mass: 5.97219e24,
//		velocity: [0,-12.5]	// m/s		//	need a properly balanced initial condition or the orbit will wander off
//	}) );
//	bodies.push( new Body({
//		ctx: ctx,
//		name: 'Luna',
//		mass: 0.07342e24,
//		position: [0.384748e9,0],	// m
//		velocity: [0,1023]	// m/s
//	})  );

	$.each(bodies,function(){
		$('table#bodies tbody').append("<tr id='"+this.name+"'><td class='name'>"+this.name+"</td><td class='mass'>"+this.mass.toExponential(3)+"</td><td class='x'>"+this.x+"</td><td class='y'>"+this.y+"</td><td class='vx'>"+this.vx+"</td><td class='vy'>"+this.vy+"</td><td class='fx'>"+this.fx+"</td><td class='fy'>"+this.fy+"</td></tr>");
	});

	var runningid = setInterval(function(){
		$.each(bodies,function(){ this.reposition(); })
		$.each(bodies,function(){ this.revelocity(bodies); });
		time = time + delta_t;
		$("#days").text( time/3600/24 );
	}, 1);

	$('button#stop').click(function(){ clearInterval(runningid); });

});
//]]>
</script>
</head>
<body>
<div id='root'>
<canvas id='myCanvas' width='1000' height='1000' style='border:1px solid #d3d3d3;'>Your browser does not support the HTML5 canvas tag.</canvas>
<table id='bodies'>
<thead><tr><th>Name</th><th>Mass (kg)</th><th colspan='2'>Position (m)</th>
<th colspan='2'>Velocity (m/s)</th><th colspan='2'>Net Force</th></tr></thead>
<tbody></tbody></table>
<p>Days&nbsp;<span id='days'></span></p>
<p><button id='stop'>Stop</button></p>
</div>
</body>
</html>
