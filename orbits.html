<html>
<head>
<title>Orbits</title>
<style>
</style>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js" type="text/javascript"></script>
<script type="text/javascript">
var G = 6.67384e-11;	//	N m^2 / kg^2
var time = 0;  // seconds
var delta_t = 7200;	// seconds
var scale = 1000000;	//	meters to pixels
var bodies = [];
function Body(_options){
	var options = {
		name:     'UnNamed',
		mass:     1.9891e30, //	kg
		position: [0,0],	// m
		velocity: [0,0]		// m/s
	}
	$.extend( true, options, _options );
	this.name = options.name;
	this.mass = options.mass;
	this.position = options.position;
	this.x = this.position[0];
	this.y = this.position[1];
	this.velocity = options.velocity;
	this.vx = this.velocity[0];
	this.vy = this.velocity[1];
	this.fx = null;
	this.fy = null;
	this.reposition = function(){
		this.x = this.x+(this.vx*delta_t);
		this.y = this.y+(this.vy*delta_t);
		if( typeof options.ctx == 'object' ){
			options.ctx.beginPath();
			options.ctx.arc( 500+(this.x/scale),500+(-this.y/scale),1,0,2*Math.PI);	// - added to invert y-axis
			options.ctx.fill();
		}
		$("tr#"+this.name+" td.x").text( this.x.toExponential(3)  );
		$("tr#"+this.name+" td.y").text( this.y.toExponential(3)  );
	};
	this.revelocity = function(bodies){
		me = this;
		fx = 0;
		fy = 0;
		$.each(bodies,function(){ 
			if( this.name != me.name ){
				dy = me.y-this.y; //	opposite
				dx = me.x-this.x;	//	adjacent
				dsquared = Math.pow( dx, 2 ) + Math.pow( dy, 2 );
				f = -( G * me.mass * this.mass ) / dsquared;

				theta = Math.atan2( dy, dx );	// NOT atan

				fx = fx + ( f * Math.cos( theta ) );
				fy = fy + ( f * Math.sin( theta ) );

$("#theta").text( theta );
			}
		});
		this.fx = fx;
		this.fy = fy;

		$("tr#"+this.name+" td.fx").text( this.fx.toExponential(3)  );
		$("tr#"+this.name+" td.fy").text( this.fy.toExponential(3)  );

		this.vx = this.vx + ( delta_t * fx / this.mass );
		this.vy = this.vy + ( delta_t * fy / this.mass );
		$("tr#"+this.name+" td.vx").text( this.vx.toExponential(3)  );
		$("tr#"+this.name+" td.vy").text( this.vy.toExponential(3)  );
	};
};
$(function(){
	$('div#root').append("<table id='bodies'><thead><tr><th>Name</th><th>Mass (kg)</th><th colspan='2'>Position (m)</th><th colspan='2'>Velocity (m/s)</th><th colspan='2'>Force</th></tr></thead><tbody></tbody></table>");
	$('div#root').append("<p>Theta(rad)&nbsp;<span id='theta'></span></p>");
	$('div#root').append("<p>Days&nbsp;<span id='days'></span></p>");
	$('div#root').append("<button id='stop'>Stop</button>");
	$('div#root').append("<canvas id='myCanvas' width='1000' height='1000' style='border:1px solid #d3d3d3;'>Your browser does not support the HTML5 canvas tag.</canvas>");

	var ctx = document.getElementById("myCanvas").getContext("2d");

//	bodies.push( new Body({ name: 'Sun' }) );
	bodies.push( new Body({
		ctx: ctx,
		name: 'Earth',
		mass: 5.97219e24 //,
//		position: [1.49598261e11,0],	// m
//		velocity: [0,29.78e3]	// m/s
	}) );
	bodies.push( new Body({
		ctx: ctx,
		name: 'Luna',
		mass: 0.07342e24,
		position: [0.384748e9,0],	// m
		velocity: [0,1023]	// m/s
	})  );

	$.each(bodies,function(){
		$('table#bodies tbody').append("<tr id='"+this.name+"'><td class='name'>"+this.name+"</td><td class='mass'>"+this.mass+"</td><td class='x'>"+this.x+"</td><td class='y'>"+this.y+"</td><td class='vx'>"+this.vx+"</td><td class='vy'>"+this.vy+"</td><td class='fx'>"+this.fx+"</td><td class='fy'>"+this.fy+"</td></tr>");
	});

	var runningid = setInterval(function(){
//		$.each(bodies,function(){ this.reposition(); })
//		$.each(bodies,function(){ this.revelocity(bodies); });
		bodies[1].reposition();
		bodies[1].revelocity(bodies);
		time = time + delta_t;
		$("#days").text( time/3600/24 );
	}, 100);

	$('button#stop').click(function(){ clearInterval(runningid); });

});
</script>
</head>
<body>
<div id='root'></div>
</body>
</html>
